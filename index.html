<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Quiz</title>
    <link rel="stylesheet" href="./stayle.css">
</head>

<body>
    <canvas id="confettiCanvas"></canvas>

    <main>
        <div class="quiz-container" role="main" aria-labelledby="title">
            <h1 id="title">ğŸ“š Quiz</h1>

            <!-- STEP 1: Ro'yhatdan o'tish -->
            <section id="step1" class="step active">
                <h3>Ro'yhatdan o'ting</h3>
                <input id="name" type="text" placeholder="Ism familiya" /><br>
                <input id="group" type="text" placeholder="Guruh" />
                <div style="display:flex;justify-content:center;gap:8px;margin-top:8px">
                    <button id="toStep2">Keyingi â¡ï¸</button>
                </div>
            </section>

            <!-- STEP 2: Fan va savol soni -->
            <section id="step2" class="step hidden">
                <h3>Fan va savol soni</h3>
                <select id="subject">
                    <option value="informatika">ğŸ“˜ Informatika</option>
                    <option value="matematika">ğŸ“— Matematika</option>
                    <option value="fizika">ğŸ“™ Fizika</option>
                    <option value="tarix">ğŸ“• Tarix</option>
                </select>
                <select id="qcount" style="margin-top:8px">
                    <option value="5">5 savol</option>
                    <option value="10" selected>10 savol</option>
                    <option value="15">15 savol</option>
                    <option value="20">20 savol</option>
                </select>
                <div style="display:flex;justify-content:center;gap:8px;margin-top:10px">
                    <button class="ghost" id="back1">â—€ï¸ Orqaga</button>
                    <button id="startQuiz">Boshlash</button>
                </div>
            </section>

            <!-- STEP 3: Quiz -->
            <section id="step3" class="step hidden">
                <div style="display:flex;justify-content:space-between;align-items:center">
                    <div>
                        <div class="small">Fan: <strong id="metaSubject"></strong></div>
                        <div class="small">Ism: <strong id="metaName"></strong> Â· Guruh: <strong id="metaGroup"></strong></div>
                    </div>
                    <div>
                        <div id="timer">â° 00:00</div>
                    </div>
                </div>

                <div id="progressBar">
                    <div id="progress"></div>
                </div>

                <div id="quiz" style="min-height:160px;margin-top:12px"></div>

                <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
                    <button class="ghost" id="prevBtn">â—€ï¸ Orqaga</button>
                    <button id="nextBtn">â¡ï¸ Keyingi</button>
                    <button id="submitBtn" class="hidden">âœ… Tugatish</button>
                </div>
                <div class="small" style="margin-top:8px">Savollar: <span id="totalCount">0</span></div>
            </section>

            <!-- STEP 4: Natija -->
            <section id="resultStep" class="step hidden">
                <div class="result-box">
                    <div style="text-align:center">
                        <div id="resultEmoji" style="font-size:48px">ğŸ‰</div>
                        <h2 id="resultTitle"></h2>
                        <p id="resultText"></p>
                        <p id="resultDetails" class="meta"></p>

                        <div style="display:flex;gap:8px;justify-content:center;margin-top:12px">
                            <button id="sendTelegramResult">ğŸ”” Telegramga yuborish</button>
                            <button id="retry">ğŸ” Yana boshlash</button>
                            <button id="back">Chiqish</button>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

<!-- Reklama modal -->
    <div id="adModal" class="hidden">
        <div class="adBox">
            <h3>Reklama</h3>
            <p>Reklamani kuting...</p>
            <button id="closeAdBtn">X</button>
        </div>
    </div>

    <script>
        const sendTelegramBtn = document.getElementById('sendTelegramResult');

sendTelegramBtn.addEventListener('click', ()=>{
    const message = `ğŸ“š Quiz natijasi
Ism: ${userName}
Guruh: ${userGroup}
Fan: ${subject.charAt(0).toUpperCase()+subject.slice(1)}
Natija: ${score}/${pool.length} (${((score/pool.length)*100).toFixed(1)}%)
Xato savollar: ${wrongQuestions.length>0 ? wrongQuestions.join(', ') : 'Yoâ€˜q'}`;

    const BOT_TOKEN = '8226398562:AAEPiTFZIQp4VdixrDCJsqfIMv9dEipj0X8';
    const CHAT_ID = '8488028783';
    
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ chat_id: CHAT_ID, text: message })
    }).then(res=>res.json())
      .then(data=>alert('Natija Telegramga yuborildi!'))
      .catch(err=>alert('Xato yuz berdi: '+err));
});

        /* ======================
        Reklama Modal JS
        ====================== */
        const adModal = document.getElementById('adModal');
        const closeAdBtn = document.getElementById('closeAdBtn');
        function showAd(duration = 5000) {
            adModal.classList.remove('hidden');
            closeAdBtn.style.display = 'none';
            setTimeout(() => { closeAdBtn.style.display = 'inline-block'; }, duration);
        }
        window.addEventListener('load', ()=>{
            const today = new Date().toISOString().slice(0,10);
            if(localStorage.getItem('adSeenToday') !== today){
                showAd(5000);
                closeAdBtn.onclick = ()=>{
                    localStorage.setItem('adSeenToday', today);
                    adModal.classList.add('hidden');
                }
            }
        });

        /* ======================
        Quiz JS
        ====================== */
        const stepEls = {
            1: document.getElementById('step1'),
            2: document.getElementById('step2'),
            3: document.getElementById('step3'),
            4: document.getElementById('resultStep')
        };
        const nameInput = document.getElementById('name');
        const groupInput = document.getElementById('group');
        const subjectSelect = document.getElementById('subject');
        const qcountSelect = document.getElementById('qcount');
        const toStep2Btn = document.getElementById('toStep2');
        const back1Btn = document.getElementById('back1');
        const startQuizBtn = document.getElementById('startQuiz');

        const quizEl = document.getElementById('quiz');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const timerEl = document.getElementById('timer');
        const totalCountEl = document.getElementById('totalCount');
        const metaSubject = document.getElementById('metaSubject');
        const metaName = document.getElementById('metaName');
        const metaGroup = document.getElementById('metaGroup');

        const resultEmoji = document.getElementById('resultEmoji');
        const resultTitle = document.getElementById('resultTitle');
        const resultText = document.getElementById('resultText');
        const resultDetails = document.getElementById('resultDetails');

        let userName='', userGroup='', subject='', qcount=10;
        let pool=[], index=0, score=0, chosen=[], wrongQuestions=[];

const BANK = {
            informatika: [
                {q:"Axborot deb nimaga aytiladi?", a:["Atrofdagi voqea-hodisalar haqidagi ma'lumotlarga","Faqat matnli ma'lumotlarga","Faqat sonli qiymatlarga"], correct:0},
                {q:"1 bayt nechta bitdan iborat?", a:["16 bit","8 bit","4 bit"], correct:1},
                {q:"Kompyuterning asosiy xotirasi qaysi?", a:["ROM","HDD","RAM"], correct:2},
                {q:"HTML ning toâ€˜liq nomi nima?", a:["Hyper Text Markup Language","High Text Markup Language","Hyperlink Text Machine Language"], correct:0},
                {q:"CSS nima uchun ishlatiladi?", a:["Sahifa dizayni uchun","Matn yozish uchun","Rasm chizish uchun"], correct:0},
                {q:"JavaScript qaysi maqsadda ishlatiladi?", a:["Interaktivlik qoâ€˜shish","Matn tahrirlash","Grafik yaratish"], correct:0},
                {q:"IP manzil nechta bitdan iborat?", a:["32 bit","64 bit","128 bit"], correct:0},
                {q:"RAM qaysi turdagi xotira?", a:["Tezkor xotira","Doimiy xotira","Virtual xotira"], correct:0},
                {q:"Binary tizimdagi 1010 = ?", a:["10","12","8"], correct:0},
                {q:"Algoritm nima?", a:["Masalani yechish tartibi","Programma xatolari","Kompyuter tili"], correct:0},
                {q:"Compiler nima qiladi?", a:["Kodlarni mashina tiliga oâ€˜giradi","Kodlarni tekshiradi","Internetga ulaydi"], correct:0},
                {q:"Database nima?", a:["Ma'lumotlar toâ€˜plami","Kompyuter xotirasi","Programma fayli"], correct:0},
                {q:"Cloud computing nima?", a:["Internet orqali resurs ishlatish","Mahalliy kompyuter ishlatish","Grafik chizish"], correct:0},
                {q:"Boolean tipda qiymatlar?", a:["True/False","0/1/2","A/B/C"], correct:0},
                {q:"Function nima?", a:["Kod blokini ishlatish","Rasm chizish","Matn tahrirlash"], correct:0},
                {q:"Loop nima?", a:["Takrorlash operatori","Shart operatori","Funksiya yaratish"], correct:0},
                {q:"Array nima?", a:["Roâ€˜yxat","Son","Matn"], correct:0},
                {q:"Object nima?", a:["Maâ€™lumotlar toâ€˜plami","Rasm","Matn"], correct:0},
                {q:"EventListener nima?", a:["Hodisaga javob beruvchi funksiya","Rasm chizuvchi funksiya","Matn tahrirlagichi"], correct:0},
                {q:"CSS selector nima?", a:["Element tanlovchisi","Kod turi","Rasm turi"], correct:0}
            ],
            matematika: [
                {q:"2 + 2 = ?", a:["3","4","22"], correct:1},
                {q:"5 * 6 = ?", a:["30","11","56"], correct:0},
                {q:"12 / 4 = ?", a:["3","4","6"], correct:0},
                {q:"7 - 3 = ?", a:["4","5","3"], correct:0},
                {q:"9 + 10 = ?", a:["19","21","20"], correct:0},
                {q:"15 % 4 = ?", a:["3","4","2"], correct:0},
                {q:"3^2 = ?", a:["6","9","8"], correct:1},
                {q:"sqrt(16) = ?", a:["4","2","8"], correct:0},
                {q:"10! = ?", a:["3628800","362880","720"], correct:0},
                {q:"Pi ning qiymati?", a:["3.14","3.15","3.41"], correct:0},
                {q:"x+5=10, x=?", a:["5","15","10"], correct:0},
                {q:"7*8=?", a:["56","48","64"], correct:0},
                {q:"100/25=?", a:["4","5","25"], correct:0},
                {q:"9*9=?", a:["81","72","99"], correct:0},
                {q:"sqrt(49) = ?", a:["7","6","8"], correct:0},
                {q:"0+0=?", a:["0","1","-1"], correct:0},
                {q:"5^0=?", a:["1","5","0"], correct:0},
                {q:"2^3=?", a:["6","8","9"], correct:1},
                {q:"10-7=?", a:["3","2","4"], correct:0},
                {q:"8/2=?", a:["4","3","2"], correct:0}
            ],
            fizika: [
                {q:"Yer gravitatsiyasi nechchi m/sÂ²?", a:["9.8","10","8"], correct:0},
                {q:"Yengil massaning tezligi?", a:["v = s/t","F = ma","E = mcÂ²"], correct:0},
                {q:"Elektr tokining oâ€˜lchov birligi?", a:["Amper","Volt","Ohm"], correct:0},
                {q:"Quyosh tizimi markazi?", a:["Quyosh","Yer","Oy"], correct:0},

{q:"Tezlik formulasi?", a:["v = s/t","v = m/t","v = t/s"], correct:0},
                {q:"Kuch birligi?", a:["Newton","Joule","Watt"], correct:0},
                {q:"Ogâ€˜irlik birligi?", a:["Newton","Kilogram","Gram"], correct:0},
                {q:"Suv qaynash harorati?", a:["100Â°C","90Â°C","110Â°C"], correct:0},
                {q:"Atom yadrosi nima?", a:["Proton + Neutron","Elektron","Neutron"], correct:0},
                {q:"Tezlikni oâ€˜lchash birligi?", a:["m/s","km/h","kg"], correct:0},
                {q:"Kinetik energiya formula?", a:["E=0.5*m*vÂ²","E=m*g*h","E=m*v"], correct:0},
                {q:"Potensial energiya formula?", a:["E=m*g*h","E=0.5*m*vÂ²","E=m*v"], correct:0},
                {q:"Ohm qonuni?", a:["V=IR","I=VR","R=VI"], correct:0},
                {q:"Magnit induksiya birligi?", a:["Tesla","Henry","Joule"], correct:0},
                {q:"Bosim formulasi?", a:["P=F/A","P=F*v","P=F*A"], correct:0},
                {q:"Suyuqlik zichligi?", a:["Ï=m/V","Ï=V/m","Ï=F/A"], correct:0},
                {q:"Suyuqlik oqimi?", a:["Q=V*A","Q=V/A","Q=A/V"], correct:0},
                {q:"Quyosh energiyasi manbai?", a:["Termoyadro","Yonish","Atom"], correct:0},
                {q:"Lazer nurlari nima?", a:["Koâ€˜p energiyali yorugâ€˜lik","Oddiy yorugâ€˜lik","Rangli yorugâ€˜lik"], correct:0},
                {q:"Raqamli signal nima?", a:["Diskret qiymatlar","Uzluksiz qiymatlar","Chiziqli signal"], correct:0}
            ],
            tarix: [
                {q:"Oâ€˜zbekiston mustaqilligi qachon e'lon qilindi?", a:["1991","1990","1992"], correct:0},
                {q:"Buyuk Ipak Yoâ€˜li kimlar tomonidan ishlatilgan?", a:["Markaziy Osiyo xalqlari","Evropa xalqlari","Xitoy xalqlari"], correct:0},
                {q:"Xorazmshohlar qachon hukmronlik qilgan?", a:["XII-XIII asr","XIV-XV asr","X-XI asr"], correct:0},
                {q:"Janglar qayerda boâ€˜lgan?", a:["Termiz","Samarqand","Buxoro"], correct:0},
                {q:"Oâ€˜zbekiston poytaxti?", a:["Toshkent","Samarqand","Buxoro"], correct:0},
                {q:"Amir Temur qachon yashagan?", a:["1336-1405","1300-1370","1400-1450"], correct:0},
                {q:"Oâ€˜zbekiston bayrogâ€˜i ranglari?", a:["Moviy, oq, yashil","Qizil, oq, moviy","Yashil, oq, qizil"], correct:0},
                {q:"Buyuk ipak yoâ€˜li qaysi asrda?", a:["II-VII asr","X-XII asr","XV-XVI asr"], correct:0},
                {q:"Mustaqillik kuni?", a:["1-sentabr","31-avgust","2-oktabr"], correct:1},
                {q:"Birinchi prezident?", a:["Islom Karimov","Shavkat Mirziyoyev","Abdulla Aripov"], correct:0},
                {q:"Oâ€˜zbeklar qaysi hududda yashagan?", a:["Markaziy Osiyo","Sibir","Yevropa"], correct:0},
                {q:"Samarqand qadimiy shaharmi?", a:["Ha","Yoâ€˜q","Bilmayman"], correct:0},
                {q:"Buxoro tarixiy shahar?", a:["Ha","Yoâ€˜q","Bilmayman"], correct:0},
                {q:"Chingizxon kim?", a:["Moâ€˜gâ€˜ul sarkardasi","Fors shohi","Arab sarkardasi"], correct:0},
                {q:"Buyuk Sulton qaysi davrda?", a:["XIV asr","XIII asr","XV asr"], correct:0},
                {q:"Oâ€˜zbekiston mustaqil davlat?", a:["Ha","Yoâ€˜q","Bilmayman"], correct:0},
                {q:"Xiva shahri qaysi hududda?", a:["Xorazm","Buxoro","Samarqand"], correct:0},
                {q:"Toshkent shahri qachon asos solingan?", a:["2200 yil avval","2000 yil avval","1500 yil avval"], correct:0},
                {q:"Buyuk Temuriylar davri?", a:["XIV asr","XIII asr","XV asr"], correct:0},
                {q:"Oâ€˜zbekiston hududi tarixiy qachon?", a:["Miloddan avvalgi 2-asr","1-asr","5-asr"], correct:0}
            ]
        };

        function goto(step){
            Object.values(stepEls).forEach(el=>el.classList.remove('active'));
            stepEls[step].classList.add('active');
        }

toStep2Btn.addEventListener('click', ()=>{
            userName = nameInput.value.trim();
            userGroup = groupInput.value.trim();
            if(!userName || !userGroup) return alert('Iltimos, ism va guruhni kiriting.');
            metaName.textContent = userName;
            metaGroup.textContent = userGroup;
            goto(2);
        });

        back1Btn.addEventListener('click', ()=>goto(1));

        startQuizBtn.addEventListener('click', ()=>{
            subject = subjectSelect.value;
            qcount = parseInt(qcountSelect.value,10)||10;
            pool = BANK[subject].slice(0,qcount);
            index=0; score=0; chosen=new Array(pool.length).fill(null); wrongQuestions=[];
            totalCountEl.textContent = pool.length;
            metaSubject.textContent = subject.charAt(0).toUpperCase()+subject.slice(1);
            goto(3);
            renderQuestion();
        });

        function renderQuestion(){
            const item = pool[index];
            quizEl.innerHTML='';
            const qdiv = document.createElement('div');
            qdiv.innerHTML = <p><strong>${index+1}.</strong> ${item.q}</p>;
            quizEl.appendChild(qdiv);
            item.a.forEach((opt,i)=>{
                const lbl = document.createElement('label');
                lbl.style.display='block';
                lbl.style.cursor='pointer';
                lbl.innerHTML = <input type="radio" name="opt" value="${i}" ${chosen[index]===i?'checked':''}> ${opt};
                lbl.addEventListener('click',()=>selectOption(i));
                quizEl.appendChild(lbl);
            });
            prevBtn.classList.toggle('hidden',index===0);
            nextBtn.classList.toggle('hidden',index>=pool.length-1);
            submitBtn.classList.toggle('hidden',index<pool.length-1);
        }

        function selectOption(i){
            chosen[index] = i;
            const idx = wrongQuestions.indexOf(index+1);
            if(idx !== -1) wrongQuestions.splice(idx,1);
            score = chosen.reduce((acc,val,j)=> acc + (val===pool[j].correct?1:0),0);
            if(i !== pool[index].correct) wrongQuestions.push(index+1);
        }

        nextBtn.addEventListener('click',()=>{
            if(chosen[index]===null) return alert('Iltimos javobni tanlang');
            if(index<pool.length-1){index++; renderQuestion();}
        });
        prevBtn.addEventListener('click',()=>{
            if(index>0){index--; renderQuestion();}
        });
        submitBtn.addEventListener('click', finishTest);

        function finishTest(){
            const percent = ((score/pool.length)*100).toFixed(1);
            resultEmoji.textContent = percent>=60?'ğŸ‰':'ğŸ™‚';
            resultTitle.textContent = percent>=60?'Tabriklaymiz!':'Yaxshiroq tayyorgarlik kerak';
            resultText.textContent = Siz ${subject} fanidan ${score}/${pool.length} (${percent}%) natija oldingiz.;
            if(wrongQuestions.length>0) resultText.textContent +=  Xato savollar: ${wrongQuestions.join(', ')};
            goto(4);
        }

        document.getElementById('retry').addEventListener('click',()=>{
            nameInput.value=''; groupInput.value='';
            goto(1);
        });
        document.getElementById('back').addEventListener('click',()=>goto(1));

        goto(1);
    </script>
    <script src="./sw.js"></script>
</body>
    </html>

